<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="$ dev init" />
  <meta property="og:description" content="initialize your development through good material" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="http://github.com/openhack-jgs/" />
  <!-- TODO -->
  <meta property="og:image" content="./assets/img/preview.png" />

  <link rel=" shortcut icon" href="./assets/img/favicon.ico">
  <link rel="icon" href="./assets/img/favicon.ico">

  <title>dev init</title>
  <link href="assets/css/bootstrap.css" rel="stylesheet">
  <link href="assets/css/font-awesome.css" rel="stylesheet">
  <link href="assets/css/docs.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">

  <link href="bootstrap-social.css" rel="stylesheet">

  <!-- google analytics -->
  <!-- <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42119746-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script> -->
  <script src="https://code.jquery.com/jquery-latest.js"></script>
  <link rel="stylesheet" type="text/css" href="./assets/css/slideControl.css" />
  <script type="text/javascript" src="./assets/js/jquery.slideControl.js"></script>
</head>

<body>
  <div class="dev-init-header">
    <img class="dev-init-logo" src="assets/img/dev_init_logo.png" />
    <div class="dev-init-icons">
      <div class="dev-init-icons-box">
        <!-- <span class="dev-init-padding"></span> -->
        <img class="dev-init-profile" src="assets/img/dev_init_profile.png" />
        &nbsp&nbsp&nbsp
        <!-- <span class="dev-init-padding"></span> -->
        <span id="dev-init-login">Log In</span>
      </div>
    </div>
  </div>

  <div class="dev-init-bg-container">
    <div class="dev-init-bg-title-container">
      <h1 class="dev-init-bg-title">
        Find your link here!<br>
        Everything you seek is here.
      </h1>
      <br>
      <div class="dev-init-bg-subtitle">
        Find all links for junior developers at Dev init.<br>
        And register your URL!
      </div>
    </div>
  </div>

  <div class="container">
    <div class="dev-init-search-container">
      <div class="dev-init-search-container__inner">
        <form class="dev-init-search-box">
          <input type="text" class="form-control" id="keyword" placeholder="검색할 태그를 입력해주세요">
        </form>
        <img class="dev-init-search-black" src="assets/img/dev_init_search_black.png">
      </div>
      <div id="add_filter">
        필터 추가
        <img class="dev_init_tri" src="./assets/img/dev_init_tri.png">
      </div>
    </div>

    <div id="dev-init-filter-container">
      
    </div>

    <div id="dev-init-posts-container">
    <!--  -->
    </div>
  </div>

  <footer>
  </footer>

  <img src="./assets/img/dev_init_plus.png" class="float">
  <!-- <a href="#" class="float">
    <i class="fa fa-plus my-float"></i>
  </a> -->

  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-app.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-firestore.js"></script>
  <script src="./init-firebase.js"></script>

  <script src="./assets/js/bootstrap.js"></script>
  <link rel="stylesheet" href="./assets/css/bootstrap.css">

  <script src="assets/js/jquery.js"></script>
  <script src="assets/js/docs.js"></script>

  <script type="text/javascript">
    $('.dev-init-logo').click(() => {
      window.location.href = './index.html';
    })
    $('.dev-init-profile').click(() => {
      window.location.href = './mypage.html';
    })
    var provider2 = new firebase.auth.GoogleAuthProvider();
    var tag_infos;
    $('#add_filter').click(() => {
      $('#dev-init-filter-container').html(`<div id="dev-init-filter-box">
        <div class="dev-init-category">
          <div class="dev-init-category-tag">
            <b>Web</b>
          </div>
          <div class="dev-init-category-web-sub-box">
            <!--  -->
          </div>
          <div class="dev-init-category-tag">
            <b>App</b>
          </div>
          <div class="dev-init-category-app-sub-box">
            <!--  -->
          </div>
        </div>
        <div class="dev-init-category-item">
          <div class="dev-init-category-web">
            <!--  -->
          </div>
          <div class="dev-init-category-web-sub">
            <!--  -->
          </div> 
          <div class="dev-init-category-app">
            <!--  -->
          </div>
          <div class="dev-init-category-app-sub">
            <!--  -->
          </div>
        </div>
      </div>`);

      let contentsHTML_web = '';
      let contentsHTML_app = '';
      tag_infos.forEach((item) => {
          const random_key = Math.random();
          if (item['type'] == 'WEB') {
            tag_list[item['name']] = item['tag'];
            contentsHTML_web += 
            `
            <div id="${random_key}" type="web" class="dev-init-category-tag" onclick="toggle_css(${random_key}, 'web', 1)">${item['name']}</div>
            `;
          } else {
            contentsHTML_app += 
            `
            <div id="${random_key}" type="app" class="dev-init-category-tag" onclick="toggle_css(${random_key}, 'app', 1)">${item['name']}</div>
            `;
          }          
        })
        $('.dev-init-category-web').html(contentsHTML_web);
        $('.dev-init-category-app').html(contentsHTML_app);
    });

    var tag_list = {}

    var toggle_css = function(key, type, flag) {
      document.getElementById(`${key}`).classList.toggle("dev-init-category-tag-selected");      

      if (flag == 1) {
        if(document.getElementsByClassName('dev-init-category-tag-selected').item(0).innerHTML) {
          if (type == 'web') {
            var temp = tag_list[document.getElementsByClassName('dev-init-category-tag-selected').item(0).innerHTML];
            var tempHTML_web = '';
            for (var key in temp) {
              const random_key = Math.random();
              tempHTML_web +=
              `
              <div id="${random_key}" type="web" class="dev-init-category-tag" onclick="toggle_css(${random_key}, 'web', 0)">${key}</div>
              `;
            }
            $('.dev-init-category-web-sub').html(tempHTML_web);
          } else {
            var temp = tag_list[document.getElementsByClassName('dev-init-category-tag-selected').item(0).innerHTML];
            var tempHTML_app = '';
            for (var key in temp) {
              const random_key = Math.random();
              tempHTML_app +=
              `
              <div id="${random_key}" type="web" class="dev-init-category-tag" onclick="toggle_css(${random_key}, 'app', 0)">${key}</div>
              `;
            }
            $('.dev-init-category-app-sub').html(tempHTML_app);
          }
        }
      }
    }
    var login = () => {
      firebase.auth().signInWithPopup(provider2).then(function (result) {
        // This gives you a GitHub Access Token. You can use it to access the GitHub API.
        var token = result.credential.accessToken;
        // The signed-in user info.
        var user = result.user;
        // ...
        console.log(token);
        console.log(user);
      }).catch(function (error) {
        console.log(error);
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // The email of the user's account used.
        var email = error.email;
        // The firebase.auth.AuthCredential type that was used.
        var credential = error.credential;
        // ...
      });
    };
    
    var logout = () => {
      var result = confirm("정말로 로그아웃하시겠습니까?");
      if(result){
        firebase.auth().signOut().then(function () {
          // alert("정상적으로 로그아웃되었습니다!");
        }).catch(function (error) {
          alert("서버에 문제가 있어 로그아웃에 실패했습니다.")
        });
      }else{
        // alert("저런~ 2018년에는 꼭 모두 이루세요!!");
      }
      
    }
    
    $(document).ready(function () {
      firebase.auth().onAuthStateChanged(function (user) {
        if (user) {
          // User is signed in.
          var displayName = user.displayName;
          var email = user.email;
          var emailVerified = user.emailVerified;
          var photoURL = user.photoURL;
          var isAnonymous = user.isAnonymous;
          var uid = user.uid;
          var providerData = user.providerData;
          // ...
          console.log(user);
          $("#dev-init-login").html(`<div onclick="logout()">Log Out</div>`);
        } else {
          // User is signed out.
          // ...
          $("#dev-init-login").html(`<div onclick="login()">Log In</div>`);
        }
      });
      
      $.ajax({
        method: "GET",
        url: "http://106.10.34.9:3000/main_page",
        data: {}
      }).then(function (data) {
        // console.log(dummy);
        console.log(data[0])
        let contentsHTML = '';
        let contentsHTML_web = '';
        let contentsHTML_app = '';
        tag_infos = data[0];
        data[0].forEach((item) => {
          const random_key = Math.random();
          if (item['type'] == 'WEB') {
            tag_list[item['name']] = item['tag'];
            contentsHTML_web += 
            `
            <div id="${random_key}" type="web" class="dev-init-category-tag" onclick="toggle_css(${random_key}, 'web', 1)">${item['name']}</div>
            `;
          } else {
            contentsHTML_app += 
            `
            <div id="${random_key}" type="app" class="dev-init-category-tag" onclick="toggle_css(${random_key}, 'app', 1)">${item['name']}</div>
            `;
          }          
        })
        $('.dev-init-category-web').html(contentsHTML_web);
        $('.dev-init-category-app').html(contentsHTML_app);

        data[1].forEach(o => {
          var avg_level = Math.round(Number(o['level'] / o['level_count']));
          // if (o.tag == app) return;
          contentsHTML +=
            `
          <div class="dev-init-post" data-postid="${o['post_id']}" data-url="${o['og:url']}">
            <div class="dev-init-img-box">
              <img class="dev-init-img" src="${o['og:image']}">
            </div>
            <div class="dev-init-post__right">

              <div class="dev-init-post__right-left">
                <div>
                  <h3 class="dev-init-title">${o['og:title']}</h3>
                  <p class="dev-init-description">${o['og:description']}</p>
                </div>
                <ul class="dev-init-tags">
                  <li>tag1</li>
                  <li>tag2</li>
                </ul>
              </div>

              <div class="dev-init-post__right-right">
                <div class="dev-init-level">
                  <span class="dev-init-level-label">Lv</span>
                  <span class="dev-init-level-data">${avg_level}</span>
                </div>
                <div class="dev-init-heart">
                  <img class="dev-init-heart-icon" src="assets/img/dev_init_heart.png">
                  <div class="dev-init-heart-data">${o['like_count']}</div>
                </div>
              </div>
            </div>
          </div>
          `;
        });

        $('#dev-init-posts-container').html(contentsHTML);

        $(".dev-init-post__right-left").click(function () {
          //새창 띄우고
          window.open(this.dataset.url);

          //모달 띄우고
          // console.log(this.dataset.postid);
          comment_postid = this.dataset.postid;
          $('#comment_modal').modal('show');
        });

        $(".check").click(function () {
          var str = "";
          $(".check").each(function () {
            if ($(this).is(":checked"))
              str += $(this).val() + " ";
          });
          $("#Multi").text(str);  // #multiPrint에 체크된 원소를 출력한다.

        });

        
        $("#status").click(() => {
          firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
              // User is signed in.
              var displayName = user.displayName;
              var email = user.email;
              var emailVerified = user.emailVerified;
              var photoURL = user.photoURL;
              var isAnonymous = user.isAnonymous;
              var uid = user.uid;
              var providerData = user.providerData;
              // ...
              console.log(user);
            } else {
              // User is signed out.
              // ...
              console.log('nono')
            }
          });

        });
        
        $("#logout").click(() => {
          firebase.auth().signOut().then(function () {
            console.log("Sign-out successful")
          }).catch(function (error) {
            console.log("An error happened.")
          });
        })
      });
    });
  </script>
  <!-- 2 CSS files are required: -->
    <!--   * Tag-it's base CSS (jquery.tagit.css). -->
    <!--   * Any theme CSS (either a jQuery UI theme such as "flick", or one that's bundled with Tag-it, e.g. tagit.ui-zendesk.css as in this example.) -->
    <!-- The base CSS and tagit.ui-zendesk.css theme are scoped to the Tag-it widget, so they shouldn't affect anything else in your site, unlike with jQuery UI themes. -->
    <link href="./assets/css/jquery.tagit.css" rel="stylesheet" type="text/css">
    <link href="./assets/css/tagit.ui-zendesk.css" rel="stylesheet" type="text/css">
    <!-- If you want the jQuery UI "flick" theme, you can use this instead, but it's not scoped to just Tag-it like tagit.ui-zendesk is: -->
    <!--   <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/flick/jquery-ui.css"> -->

    <!-- jQuery and jQuery UI are required dependencies. -->
    <!-- Although we use jQuery 1.4 here, it's tested with the latest too (1.8.3 as of writing this.) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js" type="text/javascript"
        charset="utf-8"></script>
    <script src="./assets/js/tag-it.js" type="text/javascript" charset="utf-8"></script>

    <!-- Modal -->
    <!-- The Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                          aria-hidden="true">&times;</span></button>
                  url: <input type="text" id="url" onfocusout="url_focusout()">
                  <table>
                      <tr data-href="www.naver.com" style="cursor:pointer;">
                          <td><img src="#" id='image'></td>
                      </tr>
                      <tr data-href="www.naver.com" style="cursor:pointer;">
                          <td id='description'>description</td>
                      </tr>
                  </table>
                  <!--tag-->
                  <ul id="removeConfirmationTags">
                      <li>tag</li>
                  </ul>
                  <!--slider-->
                  <div class="content">
                      <label>level: </label><input type="text" value="6.0" class="slideControl" maxlength="3"
                          name="level" id="level" />
                  </div>
                  <input type="button" value="submit" onclick="send_data()" data-dismiss="modal"
                      aria-label="Close"></input>

              </div>
          </div>
      </div>
  </div>
  <!------------------------------------------------------------------------>
  <!-- Modal -->
  <!-- The Modal -->
  <div class="modal fade" id="comment_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                          aria-hidden="true">&times;</span></button>
                  <!--slider-->
                  <div class="content">
                      <label>level: </label><input type="text" value="6.0" class="slideControl" maxlength="3"
                          id="comment_level" />
                  </div>

                  <div class="comment">
                      comment
                      <textarea name="comment_box" id="comment" rows="5" cols="50"> </textarea>
                  </div>
                  <input type="button" value="submit" onclick="send_comment_data()" data-dismiss="modal"
                      aria-label="Close"></input>
              </div>
          </div>
      </div>
  </div>
</body>

</html>